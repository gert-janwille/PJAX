/*! PJAX v1.0.0 | (c) De Jongens van Boven - Gert-Jan Wille */
'use strict';var Pjax={wrapper:'.pjax-wrapper',container:'.pjax-container',ignorePrefetchClass:'.no-prefetch',linkClass:'.pjax-link',verbose:0,prefetch:!1,enableCache:!0,href:null,lastClickedElements:[],isAnimating:!1,animations:{},cache:{},status:{nDone:!1,oDone:!1},init:function init(){var b=this,a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};$.map(a,function(c,d){return b[d]=c}),this.href=window.location.href,this.lastElements.push(this.href),window.addEventListener('popstate',function(c){return b._popAction(c)}),this._start()},backToPage:function backToPage(a){this.href!==a&&(this.isAnimating||(this.lastElements=[],this._storeLatest(a),this._trigger({},a)))},_start:function _start(){var a=this;this.prefetch&&this._prefetch(),$('a').off().click(function(b){b.target.classList.contains(a.linkClass.split('.').join(''))&&(b.preventDefault(),a._changeJS(b.target),a._storeClickedElements(b.target),a._storeLatest(b.target.href),!a.isAnimating&&a._trigger(b,b.target.href))})},animate:function animate(a){this.animations=a},_trigger:function _trigger(a,b){var c=this;b||(b=a.target);b&&this.href!==b&&(history.pushState(null,null,b),this.href=b,this._loadContent(b).then(function(d){return c._replaceContent(d)}))},_loadContent:function _loadContent(a){var b=this;return this.cache[a]?new Promise(function(c){return c(b.cache[a])}):(this.verbose?console.log('Fetching '+a):null,this._cachePages(a))},_replaceContent:function _replaceContent(a){var b=$('<div></div>').append(a),c=b.find('title');c&&(document.title=c[0].innerHTML),this.oldContainer=$(this.container),this.newContainer=b.find(this.container),this._animate()},_animate:function _animate(){var a=this;this.isAnimating=!0,this.animations.start&&this.animations.start(this),$(this.wrapper).append(this.newContainer),$(this.oldContainer).promise().done(function(){return a._done('oDone')}),$(this.newContainer).promise().done(function(){return a._done('nDone')}),this._start()},_prefetch:function _prefetch(){if(this.enableCache){this.prefetch=null,this.verbose&&console.log('Prefetching all pages...');var b=this._getLinks();this._crawlPages(b)}},_AllLinks:[],_crawlPages:function _crawlPages(a){var b=this;a.map(function(c){b._cachePages(c).then(function(d){var g=$('<div></div>').append(d),h=b._getLinks(g);return h.length?void h.map(function(i){-1!==b._AllLinks.indexOf(i)||(b._AllLinks.push(i),b._AllLinks.map(function(j){return b.cache[j]===void 0?b._crawlPages([j]):null}))}):b.verbose?console.log('All pages Fetched',b.cache):null}).catch(function(d){return console.error('Crawling Error: ',d)})})},_cachePages:function _cachePages(a){var b=this;return fetch(a,{method:'GET'}).then(function(c){return b.enableCache?b.cache[a]=c.text():c.text()}).catch(function(c){return console.error('Fetch Error',c)})},_getLinks:function _getLinks(a){var b=this,c=[];return a?this._getLinksFromData(a):($('a').each(function(){-1!==$.inArray(this.href,c)||this.classList.contains(b.ignorePrefetchClass)||c.push(this.href)}),c)},_getLinksFromData:function _getLinksFromData(a){var b=this,c=[];return a.find('a').each(function(){-1!==$.inArray(this.href,c)||this.classList.contains(b.ignorePrefetchClass)||c.push(this.href)}),c},_storeClickedElements:function _storeClickedElements(a){this.lastClickedElements.unshift(a.href),3<this.lastClickedElements.length&&this.lastClickedElements.pop()},lastElements:[],_storeLatest:function _storeLatest(a){this.lastElements.push(a),2<this.lastElements.length&&this.lastElements.shift()},_popAction:function _popAction(a){var b=window.location.href;this.isAnimating=!1,this._trigger(a,b)},_changeJS:function _changeJS(a){var b=this;['on','off'].map(function(c){return b._mapJS(a,c)})},files:{},_mapJS:function _mapJS(a,b){var c=this;this.files[b]&&this.files[b].map(function(g){return c._includeJS(g,'off'===b?'on':'off')});var d=a.getAttribute('js-'+b);this.files[b]=d?d.split(' '):[],this.files[b].map(function(g){return c._includeJS(g,b)})},_includeJS:function _includeJS(a,b){if('on'==b){var c=document.getElementsByTagName('body')[0],d=document.createElement('script');d.src=a,d.type='text/javascript',d.id=a,c.appendChild(d)}else try{var g=document.getElementById(a);g.parentNode.removeChild(g)}catch(h){console.warn('id: '+a+' not found.')}},_done:function _done(a){this.status[a]=!0,this.status.nDone&&this.status.oDone&&($(this.oldContainer).remove(),this.isAnimating=!1,this.status={nDone:!1,oDone:!1})}};
